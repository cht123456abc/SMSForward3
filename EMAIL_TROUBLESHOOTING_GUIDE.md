# 邮件发送故障排除指南

## 🔧 新增的错误处理功能

### 1. **自动重试机制**
- 应用会自动尝试TLS连接（端口587）
- 如果TLS失败，会自动切换到SSL连接（端口465）
- 提供详细的错误信息和解决建议

### 2. **网络诊断工具**
- 点击"网络诊断"按钮可以检测：
  - 网络连接状态
  - TLS端口(587)连通性
  - SSL端口(465)连通性
  - 提供针对性的解决建议

### 3. **增强的超时设置**
- 连接超时：10秒
- 读取超时：10秒
- 写入超时：10秒

## 🚨 常见错误及解决方案

### 错误1：连接超时 (ETIMEDOUT)
**症状：** `Couldn't connect to host, port: smtp.qq.com, 587; timeout -1`

**可能原因：**
1. 网络连接问题
2. 防火墙阻止邮件端口
3. VPN或代理干扰
4. 运营商限制

**解决步骤：**
1. 检查网络连接是否正常
2. 尝试关闭VPN或代理
3. 切换到移动数据网络测试
4. 使用网络诊断工具检测端口连通性

### 错误2：认证失败 (535 Authentication failed)
**症状：** 邮箱认证失败

**可能原因：**
1. QQ邮箱地址错误
2. 使用了QQ密码而不是授权码
3. 未启用SMTP服务

**解决步骤：**
1. 确认QQ邮箱地址正确
2. 在QQ邮箱设置中启用SMTP服务
3. 生成新的授权码并使用
4. 不要使用QQ登录密码

### 错误3：SSL/TLS握手失败
**症状：** SSL handshake failed

**解决步骤：**
1. 应用会自动尝试不同的连接方式
2. 检查设备时间是否正确
3. 更新应用到最新版本

## 📱 使用网络诊断功能

1. 在邮件配置页面点击"测试邮件"
2. 如果失败，会显示错误对话框
3. 点击"网络诊断"按钮
4. 等待诊断完成
5. 查看诊断结果和建议
6. 根据建议进行相应调整

## 🔍 诊断结果解读

### 网络连接正常，但端口不可达
- **TLS端口(587)不可达，SSL端口(465)可用**：应用会自动使用SSL
- **SSL端口(465)不可达，TLS端口(587)可用**：应用会使用TLS
- **两个端口都不可达**：网络限制，需要更换网络环境

### 网络连接异常
- 检查WiFi或移动数据连接
- 尝试访问其他网站确认网络状态
- 重启网络连接

## 🛠️ 高级故障排除

### 企业或学校网络
- 联系网络管理员开放邮件端口
- 使用移动数据网络作为替代方案

### 运营商限制
- 某些运营商可能限制邮件端口
- 尝试使用不同的网络运营商
- 联系运营商客服咨询

### 防火墙问题
- 检查设备防火墙设置
- 临时关闭安全软件测试
- 将应用添加到防火墙白名单

## 📞 获取帮助

如果按照以上步骤仍无法解决问题，请：
1. 记录完整的错误信息
2. 记录网络诊断结果
3. 说明网络环境（WiFi/移动数据/企业网络等）
4. 联系技术支持

## 🔄 测试建议

1. **首次配置**：建议在移动数据网络下进行测试
2. **定期测试**：每月测试一次邮件配置确保正常工作
3. **网络变更**：更换网络环境后重新测试
4. **故障排除**：使用网络诊断工具辅助问题定位
